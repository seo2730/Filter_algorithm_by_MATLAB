# Extended Kalman Filter(확장 칼만 필터)

기존 칼만필터는 선형 시스템을 대상으로 개발된 알고리즘이라 비선형 시스템에는 적용하지 못하기 때문이다.<br>
비선형 시스템에 적용하기 위한 개발된 칼만필터가 확장 칼만 필터이다.<br> 
영어로는 Extended Kalman Filter라고 하면 줄여서 **EKF**라고 한다.<br>
**EKF의 주의점**은 **발산** 위험이 있다는 것이다.

### 선형화 칼만필터(Linearized Kalman Filter)
알고리즘은 기존 칼만필터 알고리즘과 동일하다.<br>
차이점은 시스템 모델에 차이가 있다. 기존 칼만은 시스템 모델이 선형이지만 선형화 칼만필터는 **비선형 시스템**을 **선형화** 시켜 얻은 시스템 모델이다.<br>
<br>
선형화 칼만필터를 실제 시스템에 적용할 때 **시스템 운용 범위**에 각별히 유의해야한다.<br>
선형화 모델은 기준점 근처에서만 실제 시스템과 비슷하기 때문이다.<br>
-> 이 범위를 벗어나면 선형화 모델은 더 이상 믿을 수 없게 된다.
-> 이러한 한계를 무시하고 선형화 칼만 필터를 함부로 적용하면 제대로 된 성능을 내지 못하게 된다.<br>
-> 결론적으로 실제 시스템을 적용할 때는 선형화 모델이 유효한 범위 내에서만 사용해야 한다. 그렇다면 성능을 보장할 수 없다.<br>
<br>
선형화 방법에는 현재 fuzzy에 관한 내용을 공부할 때 배웠다. fuzzy 공부하실 때 배우시면 좋다.

### 확장 칼만 필터 알고리즘

#### 비선형 시스템 모델
![image](https://user-images.githubusercontent.com/42115807/107730526-fe79f880-6d36-11eb-810f-5291a2c6c230.png)<br>
이 식이 바로 비선형 시스템 모델이다.<br>
지금까지 봐온 선형 모델과 다른 점은 상태변수(x_k)와 계수를 따로 분리해서 쓰지 못한다는 점이다.<br>
아래 그림이 선형 시스템 모델과 비선형 시스템 모델 비교한 그림이다.<br>
![image](https://user-images.githubusercontent.com/42115807/107730686-60d2f900-6d37-11eb-8e96-53114bc1d50e.png)<br>
<br>
아래 그림은 기존 칼만 필터 알고리즘에서 확장 칼만 필터 알고리즘으로 표현한 식이다.<br>
![image](https://user-images.githubusercontent.com/42115807/107730789-a1327700-6d37-11eb-81d3-b484ff6912ae.png)<br>
빨간 줄이 기존 식에서 바뀐 것들을 밑줄 친 것이다.<br>
차이점을 명확하게 보여드리자면<br>
![image](https://user-images.githubusercontent.com/42115807/107730947-071efe80-6d38-11eb-9d76-2089ac2ebe42.png)
![image](https://user-images.githubusercontent.com/42115807/107730961-0f773980-6d38-11eb-8dbd-bcb303def4d2.png)<br>
이러한 차이점이 있다.<br>
그러면 여기서 궁금한게 생기는데 공분산 P와 칼만 필터 gain인 K에서 A,H를 어떻게 구하는 것인가?<br>
가장 고전적인 방법은 **자코비안** 방법을 쓰는 것이다. 즉 **편미분**을 이용하겠다는 말이다.<br>
아래 식이 자코비안의 간단한 식이다.<br>
![image](https://user-images.githubusercontent.com/42115807/107731106-7399fd80-6d38-11eb-95da-6db1a2c6053b.png)
